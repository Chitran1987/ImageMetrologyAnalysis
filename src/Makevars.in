# --- Fortran sources to compile ---
OBJECTS = linalg_solver.o fortran_utils.o fft_utils.o fortran_expose.o

# --- Compiler flags ---
# FFTW_CFLAGS will be substituted by configure (e.g. -I/usr/local/include)
PKG_FCFLAGS = $(FCFLAGS) @FFTW_CFLAGS@ -fopenmp -ffree-line-length-none

# --- Linker flags ---
# FFTW_LIBS will be substituted by configure (e.g. -L/usr/local/lib -lfftw3)
PKG_LIBS = @FFTW_LIBS@ $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS) -fopenmp

# --- Ubuntu robustness: force Fortran driver for final link ---
SHLIB_FCLD = $(FC)

# --- Extra robustness: ensure linker can find libgfortran even when using gcc/ld ---
GFORTRAN_LIBDIR := $(shell dirname `$(FC) -print-file-name=libgfortran.so`)
PKG_LIBS += -L$(GFORTRAN_LIBDIR)

# --- Optional cleanup rule (used by R CMD CLEAN) ---
clean:
	rm -f $(OBJECTS) $(SHLIB)

