# --- Objects to compile/link into the package shared library ---
PKG_OBJECTS = linalg_solver.o fortran_utils.o fft_utils.o fortran_expose.o

# --- Compiler flags (Fortran) ---
# FFTW_CFLAGS will be substituted by configure (e.g. -I/usr/local/include)
PKG_FCFLAGS = $(FCFLAGS) @FFTW_CFLAGS@ -fopenmp -ffree-line-length-none

# --- Linker flags ---
# FFTW_LIBS will be substituted by configure (e.g. -L/usr/local/lib -lfftw3)
PKG_LIBS = @FFTW_LIBS@ $(LAPACK_LIBS) $(BLAS_LIBS) $(FLIBS) -fopenmp

# --- Ensure the final shared library link is driven by the Fortran compiler ---
SHLIB_FCLD = $(FC)

# --- Help the linker find libgfortran on distros where it lives in a GCC private dir ---
GFORTRAN_LIBDIR = $(shell dirname "$$($(FC) -print-file-name=libgfortran.so)")
PKG_LIBS += -L$(GFORTRAN_LIBDIR)

# --- Cleanup (used by R CMD clean) ---
clean:
	rm -f $(PKG_OBJECTS) $(SHLIB)
